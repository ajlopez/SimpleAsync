function Sequence() {    var fns = [];        this.then = function (fn) {        fns.push(fn);        return this;    }        this.run = function (data) {        setImmediate(function () {            var k = 0;                        var l = fns.length;                        doStep();                        function doStep() {                if (k >= l)                    return;                                    var fn = fns[k++];                                if (fn.length > 1) {                    fn(data, function (newdata) {                        data = newdata;                        setImmediate(doStep);                    });                }                else {                                    data = fn(data);                    setImmediate(doStep);                }            }        });                return this;    }}function createSequence() {    return new Sequence();}module.exports = createSequence;